<link rel="import" href="../../bower_components/polymer/polymer.html">

<dom-module id="profile-page">
  <template>   

  	<link rel="stylesheet" href="../../css/enquetepage.css">
  	<link rel="stylesheet" href="../../css/ionicons.min.css">
  	<link rel="import" href="../../bower_components/font-roboto/roboto.html">
  	<link rel="import" href="../../bower_components/iron-flex-layout/classes/iron-flex-layout.html">
  	<link rel="import" href="../../bower_components/iron-fit-behavior/iron-fit-behavior.html">
    <link rel="import" href="../../bower_components/iron-image/iron-image.html">
    <link rel="import" href="../../bower_components/google-chart/google-chart.html">

    <link rel="import" href="../../bower_components/iron-ajax/iron-ajax.html">
    <iron-ajax
      id="getCurrentUser"
      url='/api/currentuser'
      last-response="{{currentuser}}"
      on-response="handleResponseUser"
      handleAs="json">
    </iron-ajax>

    <iron-ajax
      id="getMaxPoints"
      last-response="{{maxpoints}}"
      on-response="handleResponsePoints"
      handleAs="json">
    </iron-ajax>

  	<div class="horizontal layout flex">
	  	<div class="flex relative" style="background-color: #FFFFFF; z-index:10; margin-right: 3px;">
	  		<div class="vertical layout center fit" style="background-color: rgba(76,183,255,0.1);">
          <div class="vertical layout" id="sidePPanel">
            <google-chart
              on-google-chart-select="chartSelect"
              id="pieChart"
              type='pie'
              class="pieChart"
              cols='[{"label":"Profile", "type":"string"}, {"label":"Score", "type":"number"}]'>
            </google-chart>  

            <div id="profileStateList" class="horizontal layout center" on-click="selectProfile">
              <span class="profileStateBigIcon" id="0" style="border-color:#1cbbb4"></span>
              <p class="profileStateSelectedText">Consument</p>
              <div class="flex"></div>
              <span class="scoreSelectedIcon">    </span>
            </div>
            <div id="profileStateList" class="horizontal layout center" on-click="selectProfile">
              <span class="profileStateIcon" id="1" style="border-color:#acd373"></span>
              <p class="profileStateText">Verzamelaar</p>
              <div class="flex"></div>
              <span class="scoreIcon">    </span>
            </div>
            <div id="profileStateList" class="horizontal layout center" on-click="selectProfile">
              <span class="profileStateIcon" id="2" style="border-color:#fbaf5d"></span>
              <p class="profileStateText">Strateeg</p>
              <div class="flex"></div>
              <span class="scoreIcon">    </span>
            </div>
            <div id="profileStateList" class="horizontal layout center" on-click="selectProfile">
              <span class="profileStateIcon" id="3" id="0" style="border-color:#f26d7d"></span>
              <p class="profileStateText">Netwerker</p>
              <div class="flex"></div>
              <span class="scoreIcon">    </span>
            </div>
            <div id="profileStateList" class="horizontal layout center" on-click="selectProfile">
              <span class="profileStateIcon" id="4" style="border-color:#a864a8"></span>
              <p class="profileStateText">Producent</p>
              <div class="flex"></div>
              <span class="scoreIcon">    </span>
            </div>
          </div>
        </div>
	  	</div>
	    <div class="middlePanel relative vertical layout card">

        <div class="horizontal layout center">
          <div class="flex"></div>
          <div class="horizontal layout">
            <div id="tabList">
              <p id="0" on-click="selectTab" class="tabSelectedText">info</p>
            </div>
            <div id="tabList">
              <p id="1" on-click="selectTab" class="tabText">voortgang</p>
            </div>
            <div id="tabList">
              <p id="2" on-click="selectTab" class="tabText">tips</p>
            </div>
          </div>
        </div>

        <link rel="import" href="../../bower_components/neon-animation/neon-animated-pages.html">
        <link rel="import" href="../../bower_components/neon-animation/neon-animations.html">
        <neon-animated-pages id="tabPages" class="flex" style="height: 800px;" selected="0" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">

          <div class="vertical layout noselect">
            <neon-animated-pages id="profilePages" style="height: 750px; padding-bottom: 50xp;" class="flex" selected="0" entry-animation="[[entryAnimation]]" exit-animation="[[exitAnimation]]">
              <div class="vertical layout center">
                <p class="profileTitleText">Consument</p>
                <iron-image style="height: 200px;" src="../../images/Consument.png"></iron-image>
                <p class="profileText">Een consument is een passieve gebruiker van de media. Consumenten verwerken media in de ruime zin van het woord, door het lezen van berichten en het bekijken van video’s en websites. Ze communiceren online vooral via e-mail of via instant messaging (bv. WhatsApp), maar ze maken het liefst contact met mensen door persoonlijke gesprekken. 
                Een consument is soms lid van informele social media platforms, waar hij berichten leest en een enkele keer post. Hij gebruikt de sociale media voornamelijk voor privézaken, bijvoorbeeld om contacten te onderhouden met bekenden. Voor het lezen en verwerken van  informatie heeft de consument een duidelijke voorkeur voor de papieren versie. </p>
                <p class="profileText"><b>Mediagebruik:</b> surfen, informatie zoeken, berichten lezen, mailen, video’s en foto’s bekijken, profielen bekijken en reviews lezen.</p>
              </div>
              <div class="vertical layout center">
                <p class="profileTitleText">Verzamelaar</p>
                <iron-image style="height: 200px;" src="../../images/Verzamelaar.png"></iron-image>
                <p class="profileText">Een verzamelaar is een actieve gebruiker van de media. 
                Verzamelaars hebben zich aangemeld bij verschillende sociale netwerken en monitoren veel documenten, afbeeldingen, websites, filmpjes en muziek. Ze lezen en beoordelen of zij het zelf kunnen gebruiken. Ze delen hun bevindingen via hun website of sociale media. Hun zoekgedrag wordt gekenmerkt door goede zoekwoorden en ze gebruiken sociale bookmarking om websites terug te vinden. Sommigen gaan een stap verder en bekijken hoe anderen het kunnen gebruiken. Ze vormen de schakel tussen diegene die veel content creëert en degene die vooral content consumeert. </p>
                <p class="profileText"><b>Mediagebruik:</b> informatie zoeken en delen, profiel op social media, bronnen vergelijken, uploaden, informatie organiseren, blog lezen, ervaringen delen op platforms en social bookmarking.</p>
              </div>
              <div class="vertical layout center">
                <p class="profileTitleText">Strateeg</p>
                <iron-image style="height: 200px;" src="../../images/Strateeg.png"></iron-image>
                <p class="profileText">Een strateeg ontwikkelt een doelgerichte strategie om in alle levenssferen optimaal gebruik te maken van de mogelijkheden die traditionele, nieuwe en sociale media bieden. Hij heeft  een persoonlijk (informeel) digitaal netwerk gevormd en weet de media op het juiste moment in én uit te schakelen. Hij kijkt met kritische blik naar nieuwe toepassingen en schrijft hier reviews over. Hij weet wanneer welke toepassingen meerwaarde hebben bij het realiseren van professionele en sociale doelstellingen en kan deze effectief inzetten. Strategen delen hun expertise met anderen om ook hun mediastrategie te optimaliseren. Zij hebben niet alleen eigen doelen voor ogen, maar helpen ook die van anderen te realiseren.</p>
                <p class="profileText"><b>Mediagebruik:</b> reflecteren, informeel leren in netwerken, doceren over social media, blogs schrijven, reviewen, mediastrategie uitzetten, co-creatie</p>
              </div>
              <div class="vertical layout center">
                <p class="profileTitleText">Netwerker</p>
                <iron-image style="height: 200px;" src="../../images/Netwerker.png"></iron-image>
                <p class="profileText">Een netwerker is een interactieve gebruiker van diverse nieuwe media. Netwerkers communiceren via diverse applicaties met vrienden en collega’s. Ze zijn actief binnen diverse sociale netwerken en hebben een bewust vormgegeven profiel op meerdere sociale netwerksites. Netwerkers reageren alert en constructief op berichten van anderen. Ze gaan online relaties aan en koesteren bestaande relaties. Ze stimuleren de interactie tussen anderen en inspireren anderen optimaal gebruik te maken van sociale netwerken. Een netwerker is behalve op zichzelf ook gericht op het gemeenschappelijke doel van de community als geheel. Hij waakt over de netetiquette binnen sociale netwerken en gaat uitsluiting en destructief gedrag van anderen tegen.</p>
                <p class="profileText"><b>Mediagebruik:</b> informatie zoeken en delen, meerdere profielen op social media, faciliteren online community, interactie stimuleren, deelnemers uitnodigen, presenteren, netetiquette bewaken.</p>
              </div>
              <div class="vertical layout center">
                <p class="profileTitleText">Producent</p>
                <iron-image  style="height: 200px;" src="../../images/Producent.png"></iron-image>
                <p class="profileText">Een producent gebruikt de media om persoonlijke en professionele informatie te maken en te delen. Producenten gebruiken diverse toepassingen om unieke eigen content te creëren en delen belangwekkende informatie op diverse platforms. Ze zijn gericht op co-creatie en dragen soms bij aan forums en kennisbanken (zoals Wikipedia). Een producent kan een eigen website inrichten en onderhouden, hij creëert en deelt hoogwaardig audiovisueel materiaal, kiest een geschikt medium bij het verzenden van mediaboodschappen en giet deze in een optimale vorm.</p>
                <p class="profileText"><b>Mediagebruik:</b> Creëren, editen, delen, videobloggen, visualiseren, 3D ontwerpen, animaties maken, co-creatie.</p>
              </div>
            </neon-animated-pages>
          </div>

          <div>
            <div class="vertical layout center">
              <p class="profileTitleText" id="overviewGraphText">Consument</p>
            </div>
            <google-chart
              id="lineChart"
              type='line'
              class="lineChart">
            </google-chart>
          </div>

          <div>
            <link rel="import" href="profile-tips.html">
            <profile-tips entryanimation="{{entrya}}" exitanimation="{{exita}}" selectedprofile="{{selected}}"></profile-tips>
          </div>

        </neon-animated-pages>
      </div>
	    <div class="relative flex" style="background-color: #FFFFFF; z-index:10; margin-left:3px;">
	  		<div class="fit" style="background-color: rgba(76,183,255,0.1);"></div>
	  	</div>    
	</div>
  </template>

</dom-module>
<script>

  Polymer({
    is: "profile-page",

    properties:{
    	entryAnimation:{
    		type: String,
        value: 'slide-from-right-animation'
    	},
    	exitAnimation:{
    		type: String,
        value: 'slide-left-animation'
    	},
      isactive:{
        type: Boolean,
        value: false
      },
      maxpoints:{
        type: Object,
        value: {}
      }
    },

    observers:[
      'pageHasChanged(isactive)'
    ],

    ready: function(){   
      this.profileNames = ["consument", "verzamelaar", "strateeg", "netwerker", "producent"];   
      this.colorLight = ['#cbeef3', '#e3f2e8', '#efece5', '#eee2ea', '#e2e0f1'];
      this.colorIntense = ["#1cbbb4","#acd373","#fbaf5d","#f26d7d","#a864a8"];
      this.setChartOptions();
    },

    setChartOptions: function(){
      this.$.pieChart.options = {
        legend: 'none',
        pieHole: 0.5,
        backgroundColor: { fill:'transparent' },
        chartArea: { left:10, top:10 },
        tooltip: { trigger: 'none' },
        height: 400,
        width: 400,
        slices: {
          0: { color: '#1cbbb4', textStyle: {color: "#FFFFFF"} },
          1: { color: '#e3f2e8', textStyle: {color: "#acd373"}  },
          2: { color: '#efece5', textStyle: {color: "#fbaf5d"}  },
          3: { color: '#eee2ea', textStyle: {color: "#f26d7d"}  },
          4: { color: '#e2e0f1', textStyle: {color: "#a864a8"}  }
        },
        pieSliceBorderColor: "transparent"
      };

      this.$.lineChart.options = {
        chart: {
          title: 'Box Office Earnings in First Two Weeks of Opening',
          subtitle: 'in millions of dollars (USD)'
        },
        legend: 'none',
        width: 900,
        height: 600,
        backgroundColor: { fill:'transparent' },
        chartArea: { left:90, top:50 },
        pointSize: 10,
        series: {
          0: { color: "#1cbbb4" },
          1: { color: '#e3f2e8' },
          2: { color: '#efece5' },
          3: { color: '#eee2ea' },
          4: { color: '#e2e0f1' }
        },
        axes: {
          x: {
            0: {side: 'top'}
          }
        }
      };
    },

    chartSelect: function(){
      var check = false;
      var next;
      if(this.$.pieChart.selection.length > 0){
        check = true;
        next = this.$.pieChart.selection[0].row;
      }
      if (check && next != this.$.profilePages.selected)
        this.setProfileGraph(next);
    },

    setProfileGraph: function(next){
      this.setAnimations(next, this.$.profilePages.selected);
      this.setProfile(document.querySelectorAll('#profileStateList'), parseInt(this.$.profilePages.selected), parseInt(next));

      this.$.profilePages.selected = next;
      this.exita = this.exitAnimation;
      this.entrya = this.entryAnimation;
      this.selected = parseInt(next);

    },

    handleResponseUser: function(){
      if(this.currentuser.user.profiel.length > 0){
        
        this.$.getMaxPoints.url = '/api/maxpoints/' + this.currentuser.invulmoment.enquete.id;
        this.$.getMaxPoints.generateRequest();
      }

    },

    handleResponsePoints: function(){
      var profiles = this.currentuser.user.profiel;
      this.rows = new Array(5);

      for (var i = 0; i < profiles.length; i++)
        if (profiles[i].invulmoment.id == this.currentuser.invulmoment.id)
          for (var j = 0; j < 5; j++)
            this.rows[j] = [this.profileNames[j], profiles[i][this.profileNames[j]]/this.maxpoints[capitalizeFirstLetter(this.profileNames[j])]];

      this.$.pieChart.rows = this.rows;

      var data = new Array(profiles.length);
      for (var i = 0; i < profiles.length; i++) {
        data[i] = [
          profiles[i].invulmoment.time, 
          profiles[i].consument/this.maxpoints.Consument * 100, 
          profiles[i].verzamelaar/this.maxpoints.Verzamelaar * 100, 
          profiles[i].strateeg/this.maxpoints.Strateeg * 100, 
          profiles[i].netwerker/this.maxpoints.Netwerker * 100, 
          profiles[i].producent/this.maxpoints.Producent * 100];
      }

      //console.log(sortData([], [["1990-20-11",1],["1950-20-11",1],["1960-15-12",1],["1960-15-11",1]]))
      var dataTemp = sortData([], data);
      dataTemp.unshift(["Invulmoment", "Consument", "Verzamelaar", "Strateeg", "Netwerker", "Producent"]);

      this.$.lineChart.data = dataTemp;

      var profileStates = document.querySelectorAll("#profileStateList");
      profileStates[0].children[3].innerHTML = getStars(5*this.rows[0][1])
      profileStates[1].children[3].innerHTML = getStars(5*this.rows[1][1])
      profileStates[2].children[3].innerHTML = getStars(5*this.rows[2][1])
      profileStates[3].children[3].innerHTML = getStars(5*this.rows[3][1])
      profileStates[4].children[3].innerHTML = getStars(5*this.rows[4][1])
    },

    pageHasChanged: function(){
      if(this.isactive)
        this.$.getCurrentUser.generateRequest();
    },

    selectProfile: function(ding){
      if(ding.toElement.id != "profileStateList"){
        var next = ding.toElement.parentNode.children[0].id;
        if(parseInt(next) != this.$.profilePages.selected){
          this.setProfileGraph(next);
        }
      }
    },
    selectTab: function(ding){
      var next = ding.toElement.id;
      if(parseInt(next) != this.$.tabPages.selected){
        
        this.setAnimations(next, this.$.tabPages.selected);
        var e = document.querySelectorAll('#tabList');
        e[parseInt(next)].children[0].className = "tabSelectedText";
        e[parseInt(this.$.tabPages.selected)].children[0].className = "tabText";

        this.$.tabPages.selected = next;
      }
    },

    setAnimations: function(next, prev){
      if(parseInt(next) > prev){
        this.entryAnimation = 'slide-from-right-animation';
        this.exitAnimation = 'slide-left-animation';
      }
      else{
        this.entryAnimation = 'slide-from-left-animation';
        this.exitAnimation = 'slide-right-animation'; 
      }
    },

    setProfile: function(elements, oldB, newB){
      elements[oldB].children[1].className = "profileStateText";
      elements[newB].children[1].className = "profileStateSelectedText";

      elements[oldB].children[0].className = "profileStateIcon";
      elements[newB].children[0].className = "profileStateBigIcon";

      elements[oldB].children[3].className = "scoreIcon";
      elements[newB].children[3].className = "scoreSelectedIcon";

      this.$.pieChart.options.slices[oldB].color = this.colorLight[oldB];
      this.$.pieChart.options.slices[oldB].textStyle.color = this.colorIntense[oldB];
      this.$.pieChart.options.slices[newB].color = this.colorIntense[newB];
      this.$.pieChart.options.slices[newB].textStyle.color = "#FFFFFF";
      this.$.pieChart.drawChart();

      this.$.lineChart.options.series[oldB].color = this.colorLight[oldB];
      this.$.lineChart.options.series[newB].color = this.colorIntense[newB];
      this.$.lineChart.drawChart();

      this.$.overviewGraphText.innerHTML = capitalizeFirstLetter(this.profileNames[newB]);
    }
  });

function getStars(score){
  var resultString = "";
  var floor = Math.floor(score);
  var ceil = 5 - Math.floor(score);
  if(score % 1 >= 0.75)
    floor++;
  if(score % 1 >= 0.25)
    ceil--;

  for (var i = 0; i < floor; i++)
    resultString += " ";

  if (score % 1 >= 0.25 && score % 1 < 0.75)
    resultString += " ";

  for (var i = 0; i < ceil; i++)
    resultString += " ";


  return resultString;
};
function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1);
};
function sortData(result, data){
  if(data.length > 1){
    var lowest = "9999-99-99";
    var lowestIndex = 0;
    for (var i = 0; i < data.length; i++)
      if (compareTime(data[i][0], lowest)){
        lowest = data[i][0];
        lowestIndex = i;
      }

    result.push(formatDate(data.splice(lowestIndex, 1)[0]));
    result = sortData(result, data);
    return result;
  }
  else{
    result.push(formatDate(data[0]));
    return result;
  }
}

function formatDate(data){
  var splitted = data[0].split("-");
  data[0] = splitted[2] + "-" + splitted[1] + "-" + splitted[0];
  return data;
}

function compareTime(time1, time2){
  var t1 = time1.split('-');
  var t2 = time2.split('-');
  if (t1[0] > t2[0])
    return true;
  else if (t1[0] < t2[0])
    return false;
  else{
    if (t1[1] > t2[1])
      return true;
    else if (t1[1] < t2[1])
      return false;
    else{
      if (t1[1] > t2[1])
        return true;
      else if (t1[1] < t2[1])
        return false;
      else
        return true;
    }
  }
};

</script>